{"version":3,"sources":["webpack:///./D:/project/uniapp/SonFish/main.js","webpack:///D:/project/uniapp/SonFish/App.vue","webpack:///.vue?21f1","webpack:///./D:/project/uniapp/SonFish/store/index.js"],"names":["__webpack_require__","Vue","config","productionTip","prototype","$store","store","App","mpType","_extends","$mount","__WEBPACK_IMPORTED_MODULE_0__Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_loader_babelrc_false_retainLines_true_presets_D_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_preset_env_modules_commonjs_targets_browsers_1_last_2_versions_not_ie_8_D_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_preset_stage_2_plugins_D_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_plugin_transform_runtime_helpers_false_polyfill_false_regenerator_true_moduleName_D_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_runtime_D_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_plugin_transform_decorators_legacy_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_lib_preprocessor_loader_js_type_js_context_H5_false_APP_PLUS_false_MP_WEIXIN_true_MP_BAIDU_false_MP_ALIPAY_false_MP_TOUTIAO_false_MP_true_APP_false_APP_PLUS_NVUE_false_APP_PLUS_NVUE_false_APP_PLUS_false_MP_WEIXIN_true_MP_BAIDU_false_MP_ALIPAY_false_MP_TOUTIAO_false_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_lib_mpvue_loader_lib_selector_type_script_index_0_App_vue__","__WEBPACK_IMPORTED_MODULE_0__Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_loader_babelrc_false_retainLines_true_presets_D_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_preset_env_modules_commonjs_targets_browsers_1_last_2_versions_not_ie_8_D_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_preset_stage_2_plugins_D_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_plugin_transform_runtime_helpers_false_polyfill_false_regenerator_true_moduleName_D_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_runtime_D_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_node_modules_babel_plugin_transform_decorators_legacy_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_lib_preprocessor_loader_js_type_js_context_H5_false_APP_PLUS_false_MP_WEIXIN_true_MP_BAIDU_false_MP_ALIPAY_false_MP_TOUTIAO_false_MP_true_APP_false_APP_PLUS_NVUE_false_APP_PLUS_NVUE_false_APP_PLUS_false_MP_WEIXIN_true_MP_BAIDU_false_MP_ALIPAY_false_MP_TOUTIAO_false_Green_HBuilderX_1_3_2_20181214_full_HBuilderX_plugins_uniapp_lib_mpvue_loader_lib_selector_type_script_index_0_App_vue___default","n","disposed","__vue_styles__","ssrContext","Component","normalizeComponent","a","options","__file","esModule","Object","keys","some","key","substr","console","error","__webpack_exports__","data","provider","computed","_vuex","mapState","methods","mapMutations","mapActions","onLaunch","_this","this","uni","login","success","res","fail","e","log","getUserOpenId","onShow","onHide","use","Vuex","Store","state","hasLogin","authUserInfor","loginProvider","openid","userInfor","userInforTemp","mutations","logout","setOpenid","setUserInfor","info","setUserInforTemp","setAuthUserInfor","actions","getUserInfoNormal","_callee","_ref2","commit","dispatch","_regenerator2","default","wrap","_context","prev","next","Promise","resolve","reject","getUserInfo","infoRes","userInfo","abrupt","sent","stop","_x","_ref","apply","arguments","getUserInfOnload","_callee2","_ref4","_context2","_x2","_ref3","authUserInforFun","showModal","title","content","showCancel","complete","switchTab","url","updateUserInfor","_ref5","request","path","JSON","stringify","header","Content-type","method","_callee3","_ref7","flag","_context3","code","setTimeout","err","_x3","_x4","_ref6"],"mappings":"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","file":"app.js","sourcesContent":["import Vue from 'vue'\r\nimport App from './App'\r\n\r\nimport store from './store'\r\n\r\nVue.config.productionTip = false\r\n\r\nVue.prototype.$store = store\r\n\r\nApp.mpType = 'app'\r\n\r\nconst app = new Vue({\r\n    ...App\r\n})\r\napp.$mount()  \r\n \n\n\n// WEBPACK FOOTER //\n// ./D:/project/uniapp/SonFish/main.js","var disposed = false\nfunction injectStyle (ssrContext) {\n  if (disposed) return\n  require(\"!!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/node_modules/vue-style-loader!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/lib/css-var-loader.js!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/node_modules/css-loader?{\\\"minimize\\\":false,\\\"sourceMap\\\":false}!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/lib/mpvue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-6db6575a\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/lib/css-upx-loader.js?{\\\"baseDpr\\\":1,\\\"rpxUnit\\\":1}!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/lib/preprocessor-loader.js?{\\\"type\\\":\\\"js\\\",\\\"context\\\":{\\\"H5\\\":false,\\\"APP-PLUS\\\":false,\\\"MP-WEIXIN\\\":true,\\\"MP-BAIDU\\\":false,\\\"MP-ALIPAY\\\":false,\\\"MP-TOUTIAO\\\":false,\\\"MP\\\":true,\\\"APP\\\":false,\\\"APP-PLUS-NVUE\\\":false,\\\"APP_PLUS_NVUE\\\":false,\\\"APP_PLUS\\\":false,\\\"MP_WEIXIN\\\":true,\\\"MP_BAIDU\\\":false,\\\"MP_ALIPAY\\\":false,\\\"MP_TOUTIAO\\\":false}}!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/node_modules/postcss-loader?{\\\"config\\\":{\\\"path\\\":\\\"D:\\\\\\\\Green\\\\\\\\HBuilderX.1.3.2.20181214.full\\\\\\\\HBuilderX\\\\\\\\plugins\\\\\\\\uniapp\\\\\\\\.postcssrc.js\\\"},\\\"sourceMap\\\":true}!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/lib/preprocessor-loader.js?{\\\"type\\\":\\\"js\\\",\\\"context\\\":{\\\"H5\\\":false,\\\"APP-PLUS\\\":false,\\\"MP-WEIXIN\\\":true,\\\"MP-BAIDU\\\":false,\\\"MP-ALIPAY\\\":false,\\\"MP-TOUTIAO\\\":false,\\\"MP\\\":true,\\\"APP\\\":false,\\\"APP-PLUS-NVUE\\\":false,\\\"APP_PLUS_NVUE\\\":false,\\\"APP_PLUS\\\":false,\\\"MP_WEIXIN\\\":true,\\\"MP_BAIDU\\\":false,\\\"MP_ALIPAY\\\":false,\\\"MP_TOUTIAO\\\":false}}!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/lib/mpvue-loader/lib/selector?type=styles&index=0!./App.vue\")\n}\nvar normalizeComponent = require(\"!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/lib/mpvue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/node_modules/babel-loader?{\\\"babelrc\\\":false,\\\"retainLines\\\":true,\\\"presets\\\":[[\\\"D:\\\\\\\\Green\\\\\\\\HBuilderX.1.3.2.20181214.full\\\\\\\\HBuilderX\\\\\\\\plugins\\\\\\\\uniapp\\\\\\\\node_modules\\\\\\\\babel-preset-env\\\",{\\\"modules\\\":\\\"commonjs\\\",\\\"targets\\\":{\\\"browsers\\\":[\\\"> 1%\\\",\\\"last 2 versions\\\",\\\"not ie <= 8\\\"]}}],\\\"D:\\\\\\\\Green\\\\\\\\HBuilderX.1.3.2.20181214.full\\\\\\\\HBuilderX\\\\\\\\plugins\\\\\\\\uniapp\\\\\\\\node_modules\\\\\\\\babel-preset-stage-2\\\"],\\\"plugins\\\":[[\\\"D:\\\\\\\\Green\\\\\\\\HBuilderX.1.3.2.20181214.full\\\\\\\\HBuilderX\\\\\\\\plugins\\\\\\\\uniapp\\\\\\\\node_modules\\\\\\\\babel-plugin-transform-runtime\\\",{\\\"helpers\\\":false,\\\"polyfill\\\":false,\\\"regenerator\\\":true,\\\"moduleName\\\":\\\"D:\\\\\\\\Green\\\\\\\\HBuilderX.1.3.2.20181214.full\\\\\\\\HBuilderX\\\\\\\\plugins\\\\\\\\uniapp\\\\\\\\node_modules\\\\\\\\babel-runtime\\\"}],\\\"D:\\\\\\\\Green\\\\\\\\HBuilderX.1.3.2.20181214.full\\\\\\\\HBuilderX\\\\\\\\plugins\\\\\\\\uniapp\\\\\\\\node_modules\\\\\\\\babel-plugin-transform-decorators-legacy\\\"]}!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/lib/preprocessor-loader.js?{\\\"type\\\":\\\"js\\\",\\\"context\\\":{\\\"H5\\\":false,\\\"APP-PLUS\\\":false,\\\"MP-WEIXIN\\\":true,\\\"MP-BAIDU\\\":false,\\\"MP-ALIPAY\\\":false,\\\"MP-TOUTIAO\\\":false,\\\"MP\\\":true,\\\"APP\\\":false,\\\"APP-PLUS-NVUE\\\":false,\\\"APP_PLUS_NVUE\\\":false,\\\"APP_PLUS\\\":false,\\\"MP_WEIXIN\\\":true,\\\"MP_BAIDU\\\":false,\\\"MP_ALIPAY\\\":false,\\\"MP_TOUTIAO\\\":false}}!../../../Green/HBuilderX.1.3.2.20181214.full/HBuilderX/plugins/uniapp/lib/mpvue-loader/lib/selector?type=script&index=0!./App.vue\"\n/* template */\nvar __vue_template__ = null\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\nComponent.options.__file = \"..\\\\..\\\\..\\\\..\\\\..\\\\project\\\\uniapp\\\\SonFish\\\\App.vue\"\nif (Component.esModule && Object.keys(Component.esModule).some(function (key) {return key !== \"default\" && key.substr(0, 2) !== \"__\"})) {console.error(\"named exports are not supported in *.vue files.\")}\n\n/* hot reload */\nif (module.hot) {(function () {\n  var hotAPI = require(\"vue-hot-reload-api\")\n  hotAPI.install(require(\"vue\"), false)\n  if (!hotAPI.compatible) return\n  module.hot.accept()\n  if (!module.hot.data) {\n    hotAPI.createRecord(\"data-v-6db6575a\", Component.options)\n  } else {\n    hotAPI.reload(\"data-v-6db6575a\", Component.options)\n  }\n  module.hot.dispose(function (data) {\n    disposed = true\n  })\n})()}\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// D:/project/uniapp/SonFish/App.vue\n// module id = 8\n// module chunks = 4","<script>\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapMutations,\r\n\t\tmapActions\r\n\t} from 'vuex'\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tprovider: 'weixin',\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t//通过mapState获取的缓存数据通过this是只读的属性，需要调用mutation中的方法进行修改\r\n\t\t\t...mapState(['openid']), \r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapMutations(['login']),\r\n\t\t\t...mapActions(['getUserOpenId'])\r\n\t\t},\r\n\t\t//小程序启动时进行登录操作（登录操作需要联网，从微信服务器获得code），并与后台交互，获得openId存到store中。\r\n\t\t//启动时还需要获取用户信息，并保存到本地，每次获取用户信息后都与本地信息进行比对，如果不一致就提交后台更新\r\n\t\tonLaunch: function() {\r\n\t\t\t//登录\r\n\t\t\tuni.login({\r\n\t\t\t\tprovider: this.provider,\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tthis.login(this.provider)\r\n\t\t\t\t},\r\n\t\t\t\tfail: (e) => {\r\n\t\t\t\t\tconsole.log('fail', e)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t//获得openId，存储到store中，true缓存用户信息\r\n\t\t\tthis.getUserOpenId(true)\t\r\n\t\t},\r\n\t\tonShow: function() {\r\n\r\n\t\t},\r\n\t\tonHide: function() {\r\n\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t/*每个页面公共css */\r\n\t@import \"./common/uni.css\";\r\n</style>\n\n\n\n// WEBPACK FOOTER //\n// .vue?ec17eb04","import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nimport path from '../config/path.js'\r\n\r\nVue.use(Vuex)\r\n\r\nconst store = new Vuex.Store({\r\n\tstate: {\r\n\t\thasLogin: false,\r\n\t\tauthUserInfor: false,\r\n\t\tloginProvider: \"\",\r\n\t\topenid: null,\r\n\t\tuserInfor: null, //本地存JSON数据类型，转换成String再传到数据库\r\n\t\tuserInforTemp: null\r\n\t},\r\n\tmutations: {\r\n\t\tlogin(state, provider) {\r\n\t\t\tstate.hasLogin = true;\r\n\t\t\tstate.loginProvider = provider;\r\n\t\t},\r\n\t\tlogout(state) {\r\n\t\t\tstate.hasLogin = false\r\n\t\t\tstate.openid = null\r\n\t\t},\r\n\t\tsetOpenid(state, openid) {\r\n\t\t\tstate.openid = openid\r\n\t\t},\r\n\t\tsetUserInfor(state, info) {\r\n\t\t\tstate.userInfor = info\r\n\t\t},\r\n\t\tsetUserInforTemp(state, info) {\r\n\t\t\tstate.userInforTemp = info\r\n\t\t},\r\n\t\tsetAuthUserInfor(state, info) {\r\n\t\t\tstate.authUserInfor = info\r\n\t\t}\r\n\t},\r\n\tactions: {\r\n\t\t//程序中使用用户信息\r\n\t\t//1、先检查本地缓存，如果有就直接返回数据\r\n\t\t//2、如果没有就去微信服务器上请求数据\r\n\t\tgetUserInfoNormal: async function({\r\n\t\t\tstate,\r\n\t\t\tcommit,\r\n\t\t\tdispatch\r\n\t\t}) {\r\n\t\t\treturn await new Promise((resolve, reject) => {\r\n\t\t\t\tif (state.userInfor) {\r\n\t\t\t\t\tresolve(state.userInfor)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.getUserInfo({\r\n\t\t\t\t\t\tprovider: 'weixin',\r\n\t\t\t\t\t\tsuccess: function(infoRes) {\r\n\t\t\t\t\t\t\tstate.userInfor = infoRes.userInfo\r\n\t\t\t\t\t\t\tcommit('setAuthUserInfor', true)\r\n\t\t\t\t\t\t\tdispatch('updateUserInfor')\r\n\t\t\t\t\t\t\tresolve(infoRes.userInfo)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t//小程序启动时获取用户信息\r\n\t\t//1、如果获取的信息存入userInforTemp中，如本地的userInfor一致，就返回本地缓存。\r\n\t\t//2、如果不一致，就去微信服务器上获取，并更新本地缓存和上传数据到后台\r\n\t\tgetUserInfOnload: async function({\r\n\t\t\tcommit,\r\n\t\t\tstate,\r\n\t\t\tdispatch\r\n\t\t}) {\r\n\t\t\treturn await new Promise((resolve, reject) => {\r\n\t\t\t\t//1、先向微信服务器请求数据\r\n\t\t\t\tuni.getUserInfo({\r\n\t\t\t\t\tprovider: 'weixin',\r\n\t\t\t\t\tsuccess: function(infoRes) {\r\n\t\t\t\t\t\t//小程序启动时获取用户信息成功，将setAuthUserInfor设置为true\r\n\t\t\t\t\t\tcommit('setAuthUserInfor', true)\r\n\t\t\t\t\t\t//获得临时的用户信息，和本地缓存进行比较\r\n\t\t\t\t\t\tcommit('setUserInforTemp', infoRes.userInfo)\r\n\t\t\t\t\t\t//2、如果userInfor为null，说明是第一次请求，赋值后返回数据\r\n\t\t\t\t\t\tif (state.userInfor == null) {\r\n\t\t\t\t\t\t\tstate.userInfor = state.userInforTemp\r\n\t\t\t\t\t\t\t//更新后台用户数据\r\n\t\t\t\t\t\t\tdispatch('updateUserInfor')\r\n\t\t\t\t\t\t\tresolve(state.userInfor)\r\n\t\t\t\t\t\t\t//3、如果请求到的数据和本地的不一致，则更新本地数据和后台数据\r\n\t\t\t\t\t\t} else if (state.userInfo != state.userInforTemp) {\r\n\t\t\t\t\t\t\tstate.userInfor = state.userInforTemp\r\n\t\t\t\t\t\t\t//更新后台用户数据\r\n\t\t\t\t\t\t\tdispatch('updateUserInfor')\r\n\t\t\t\t\t\t\tresolve(state.userInfor)\r\n\t\t\t\t\t\t\t//4、直接返回数据\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresolve(state.userInfor)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t//获取用户信息失败，说明用户没有授权，则跳转授权页面，并提示用户授权\r\n\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t//小程序启动时获取用户信息失败，将setAuthUserInfor设置为false\r\n\t\t\t\t\t\tcommit('setAuthUserInfor', false)\r\n\t\t\t\t\t\tdispatch('authUserInforFun')\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tauthUserInforFun: () => {\r\n\t\t\tconsole.log('get userInfor error')\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '授权提示',\r\n\t\t\t\tcontent: '小程序需要您授权登录才能运行',\r\n\t\t\t\tshowCancel: false,\r\n\t\t\t\tcomplete: () => {\r\n\t\t\t\t\tconsole.log('提示结束')\r\n\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\turl: '/pages/user/user'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tupdateUserInfor: ({\r\n\t\t\tstate\r\n\t\t}) => {\r\n\t\t\tuni.request({\r\n\t\t\t\turl: path.updateUserInfor,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\topenid: state.openid,\r\n\t\t\t\t\t//将userInfor转换成String，上传数据库,从数据库取到数据以后要进行 JSON.parse 再将String转换为JSON\r\n\t\t\t\t\tuserInfor: JSON.stringify(state.userInfor)\r\n\t\t\t\t},\r\n\t\t\t\theader: {\r\n\t\t\t\t\t'Content-type': 'application/json'\r\n\t\t\t\t},\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tconsole.log('update userInfor success!  ', res)\r\n\t\t\t\t},\r\n\t\t\t\tfail: (res) => {\r\n\t\t\t\t\tconsole.log('update userInfor fail!  ', res)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t// lazy loading openid\r\n\t\t//获得openid并更新userInfor\r\n\t\t//flag=true 网络加载userInfor并检查用户信息更新，小程序启动的时候调用\r\n\t\t//flag=flase 程序内加载openid，不检查更新用户信息\r\n\t\tgetUserOpenId: async function({\r\n\t\t\tcommit,\r\n\t\t\tstate,\r\n\t\t\tdispatch\r\n\t\t}, flag) {\r\n\t\t\treturn await new Promise((resolve, reject) => {\r\n\t\t\t\tif (state.openid) {\r\n\t\t\t\t\tresolve(state.openid)\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//登录获得code\r\n\t\t\t\t\tuni.login({\r\n\t\t\t\t\t\tsuccess: (data) => {\r\n\t\t\t\t\t\t\tcommit('login', 'weixin')\r\n\t\t\t\t\t\t\t//将code发到后台换区openid并缓存\r\n\t\t\t\t\t\t\tuni.request({\r\n\t\t\t\t\t\t\t\turl: path.openid,\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\tcode: data.code\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\t\t'Content-type': 'application/json'\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\tcommit('setOpenid', res.data)\r\n\t\t\t\t\t\t\t\t\tresolve(state.openid)\r\n\t\t\t\t\t\t\t\t\t//通过flag参数，控制在获取openid的时候是否需要缓存用户信息\r\n\t\t\t\t\t\t\t\t\tif (flag) {\r\n\t\t\t\t\t\t\t\t\t\tdispatch('getUserInfOnload')\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: (res) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log('获取用户openID错误', res)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tconsole.log(state.openid, state.hasLogin, state.loginProvider, state.authUserInfor, state.userInfor)\r\n\t\t\t\t\t\t\t}, 5000)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\tconsole.log('uni.login 接口调用失败，将无法正常使用开放接口等服务', err)\r\n\t\t\t\t\t\t\treject(err)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n})\r\n\r\nexport default store\r\n\n\n\n// WEBPACK FOOTER //\n// ./D:/project/uniapp/SonFish/store/index.js"],"sourceRoot":""}